<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>AQTEN</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- The favicon link will be set dynamically by JavaScript -->
    <link id="favicon" rel="icon" href="#" type="image/x-icon">
    <link rel="stylesheet" href="/css/game-style.css">

  </head>
  <body>


  <div id="app-container"> 
    <canvas id="gameCanvas"></canvas>
  </div>

    <div id="top-ui-bar">
      <div id="game-controls">
          <button id="backToMenuBtn" class="btn">Main Menu</button>
      </div>

      <div id="user-session-controls">
          <button id="topRightLoginBtn" class="btn">Log In</button>
          <div id="userInfo" class="hidden">
              <span id="usernameDisplay"></span>
              <button id="topRightLogoutBtn" class="btn">Logout</button>
          </div>
      </div>
    </div>

    <div id="menu" class="menu-container">
      <div class="menu-popup">
        
        <div id="mainMenuControls">
          <h1>AQTEN</h1>
          <button id="playBtn" disabled>Loading...</button>
          <button id="caseHistoryBtn">Case History</button>
          <button id="leaderboardBtn">Leaderboard</button>    
          <button id="patchNotesBtn">Patch Notes</button>
          <button id="settingsBtn">Settings</button>

        </div>

        <div id="loginControls" class="hidden">
          <div id="loginFormContainer">
            <h1>Log In</h1>
            <form id="loginForm">
              <input type="text" id="loginUsernameInput" placeholder="Enter username" required autocomplete="off">
              <input type="password" id="loginPasswordInput" placeholder="Enter password" required autocomplete="off">
              <button type="submit" id="loginBtn">Log In</button>
              <button type="button" id="backToMenuFromLoginBtn" class="secondary-btn">Back</button>
            </form>
            <p>Don't have an account? <a href="#" id="showRegisterBtn">Register</a></p>
            <p id="loginError" class="error-message hidden">Invalid username or password.</p>
          </div>

          <div id="registerFormContainer" class="hidden">
            <h1>Register</h1>
            <form id="registerForm">
              <input type="text" id="registerUsernameInput" placeholder="Choose username" required minlength="3" autocomplete="off">
              <input type="password" id="registerPasswordInput" placeholder="Choose password" required minlength="6" autocomplete="off">
              <button type="submit" id="registerBtn">Register</button>
              <button type="button" id="backToLoginBtn" class="secondary-btn">Back to Login</button>
            </form>
            <p id="registerError" class="error-message hidden">Username is already taken.</p>
            <p id="registerSuccess" class="success-message hidden">Registration successful! Please log in.</p>
          </div>
        </div>

      </div>
    </div>

  <div id="leaderboardModal" class="modal-backdrop">
    <div class="modal-content large-modal">
        <div class="modal-header">
            <h2>Leaderboard</h2>
            <button id="closeLeaderboardBtn" class="btn-close">×</button>
        </div>
        <div class="modal-body">
            <div id="leaderboardContent" class="history-container">
                <!-- Leaderboard table will be rendered here -->
            </div>
        </div>
        <div class="modal-footer">
            <button id="backToMenuFromLeaderboardBtn" class="btn-secondary">Back to Menu</button>
        </div>
    </div>
  </div>

  <div id="settingsModal" class="modal-backdrop">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Settings</h2>
            <button id="closeSettingsBtn" class="btn-close">×</button>
        </div>
        <div class="modal-body">
            <div class="settings-item">
                <label for="showOnLeaderboardCheckbox">Show my name on the leaderboard</label>
                <input type="checkbox" id="showOnLeaderboardCheckbox">
            </div>
            <div class="settings-item" style="margin-top: 15px;">
                <label for="showAkutrumIntroCheckbox">Show Akutrum intro message</label>
                <input type="checkbox" id="showAkutrumIntroCheckbox">
            </div>
        </div>
        <div class="modal-footer">
            <button id="saveSettingsBtn" class="btn-action-final">Save</button>
        </div>
    </div>
  </div>

  <div id="caseHistoryModal" class="modal-backdrop">
    <div class="modal-content large-modal">
        <div class="modal-header">
            <h2>Your Case History</h2>
            <button id="closeHistoryBtn" class="btn-close">×</button>
        </div>
        <div class="modal-body">
            <div id="caseHistoryContent" class="history-container">
                <!-- History items will be rendered here -->
            </div>
        </div>
        <div class="modal-footer">
            <button id="backToMenuFromHistoryBtn" class="btn-secondary">Back to Menu</button>
        </div>
    </div>
  </div>

  <!-- NEW: Subtle Notification Popup -->
  <div id="subtleNotification" class="subtle-notification hidden">
      <p id="subtleNotificationText"></p>
  </div>

  <div id="patchNotesModal" class="modal-backdrop">
    <div class="modal-content large-modal">
        <div class="modal-header">
            <h2>Patch Notes</h2>
            <button id="closePatchNotesBtn" class="btn-close">×</button>
        </div>
        <div class="modal-body">
            <div id="patchNotesContent">
                <!-- Patch notes will be rendered here -->
            </div>
        </div>
        <div class="modal-footer">
            <button id="backToMenuFromPatchNotesBtn" class="btn-secondary">Back to Menu</button>
        </div>
    </div>
  </div>

  <div id="vitalsPopup">
    <div id="vitalsHeader">
      <h3 id="vitalsTitle">Patient Vitals</h3>
    </div>

    <div id="vitalsBody">
      <div class="accordion">
        <button class="accordion-header">Vital Signs</button>
        <div class="accordion-content" id="vitalsContent"></div>
      </div>

      <div class="accordion">
        <button class="accordion-header">Physical Exam</button>
        <div class="accordion-content" id="physExamContent"></div>
      </div>

      <div class="accordion">
        <button class="accordion-header">Bedside Tests</button>
        <div class="accordion-content" id="bedsideTestContent"></div>
      </div>
      
      <div class="accordion">
        <button class="accordion-header">Lab Results</button>
        <div class="accordion-content" id="labResultsContent"></div>
      </div>

      <div class="accordion">
        <button class="accordion-header">Radiology Results</button>
        <div class="accordion-content" id="radiologyResultsContent"></div>
      </div>

      <div class="accordion">
        <button class="accordion-header">Administered Meds</button>
        <div class="accordion-content" id="administeredMedsContent"></div>
      </div>

      <div class="accordion" id="interventionsAccordion" style="display: none;">
        <button class="accordion-header">Åtgärder</button>
        <div class="accordion-content" id="interventionsContent"></div>
      </div>
    </div>
  </div>

  <div id="oxygenModal" class="modal-backdrop">
    <div class="modal-content">
      <h3>Administer Oxygen</h3>
      <p>Set the flow rate (L/min):</p>
      
      <div class="slider-container">
        <div class="slider-wrapper">
          <input type="range" id="oxygenSlider" min="0" max="15" value="0" step="1">
          <div id="slider-ticks">
            <span></span><span></span><span></span><span></span>
            <span></span><span></span><span></span><span></span>
            <span></span><span></span><span></span><span></span>
            <span></span><span></span><span></span><span></span>
          </div>
        </div>
        <span id="oxygenFlowRateLabel">0 L</span>
      </div>
      
      <div class="disposition-choices">
        <button id="btnConfirmOxygen">Confirm</button>
        <button id="btnCancelOxygen">Cancel</button>
      </div>
    </div>
  </div>


<!-- Sidebar panel -->
  <div id="infoPanel">
    <h2 id="infoName">Patient</h2>
    <div id="infoDetails"></div>
    <button id="closeInfo">Close</button>
  </div>

  <div id="roomMenu">
    <h2>Patient Actions</h2>
    <input type="search" id="generalSearchInput" class="submenu-search-input" placeholder="Search all actions..." autocomplete="off">
    <button id="btnAnamnesis">Anamnesis</button>
    <button id="btnPhysical">Physical Exam</button>
    <button id="btnBedside">Bedside Tests</button>
    <button id="btnLab">Lab Tests</button>
    <button id="btnRadiology">Radiology</button>
    <button id="btnMeds">Medication</button>
    <button id="btnConsult">Consult</button> <!-- NEW BUTTON -->
    <button id="btnHomeMeds">Läkemedelslista</button>
    <button id="btnDischarge" class="btn-action-final">Disposition</button> </div>

  </div>

  <!-- NEW: ABCDE Akutrum Menu -->
  <div id="akutrumMenu" class="right-side-popup">
    <h2>Akutrum - ABCDE</h2>
    <div class="menu-body">
      <!-- NEW: Add Anamnesis button at the top -->
      <button id="btnAnamnesisAkutrum">Anamnesis</button>
      <hr class="menu-separator">
      <div class="abcde-section">
        <button class="abcde-header" data-letter="A">A - Airway</button>
        <div class="abcde-content" data-content-for="A">
          <input type="search" class="abcde-search-input" data-letter="A" placeholder="Search actions..." autocomplete="off">
          <div class="abcde-search-results"></div>
        </div>
      </div>
      <div class="abcde-section">
        <button class="abcde-header" data-letter="B">B - Breathing</button>
        <div class="abcde-content" data-content-for="B">
          <input type="search" class="abcde-search-input" data-letter="B" placeholder="Search actions..." autocomplete="off">
          <div class="abcde-search-results"></div>
        </div>
      </div>
      <div class="abcde-section">
        <button class="abcde-header" data-letter="C">C - Circulation</button>
        <div class="abcde-content" data-content-for="C">
          <input type="search" class="abcde-search-input" data-letter="C" placeholder="Search actions..." autocomplete="off">
          <div class="abcde-search-results"></div>
        </div>
      </div>
      <div class="abcde-section">
        <button class="abcde-header" data-letter="D">D - Disability</button>
        <div class="abcde-content" data-content-for="D">
          <input type="search" class="abcde-search-input" data-letter="D" placeholder="Search actions..." autocomplete="off">
          <div class="abcde-search-results"></div>
        </div>
      </div>
      <div class="abcde-section">
        <button class="abcde-header" data-letter="E">E - Exposure</button>
        <div class="abcde-content" data-content-for="E">
          <input type="search" class="abcde-search-input" data-letter="E" placeholder="Search actions..." autocomplete="off">
          <div class="abcde-search-results"></div>
        </div>
      </div>
      <!-- NEW: Add a separator and the medication button -->
      <hr class="menu-separator">
      <button id="btnMedsAkutrum">Medication</button>
      <button id="btnConsultAkutrum">Consult</button>
      <!-- NEW: Add Continue Management button -->
      <button id="btnContinueFromAkutrum" class="btn-secondary">Fortsätt i vanligt rum</button>
      <!-- NEW: Add Disposition button -->
      <button id="btnDischargeAkutrum" class="btn-action-final">Disposition</button>

    </div>
  </div>

  <div id="homeMedicationModal" class="modal-backdrop">
    <div class="modal-content large-modal">
        <div class="modal-header">
            <h2>Läkemedelslista</h2>
            <button id="closeHomeMedsModal" class="btn-close">×</button>
        </div>
        <div class="modal-body" id="homeMedicationContent">
            <!-- The home medication list will be rendered here -->
        </div>
    </div>
  </div>

  <div id="generalSearchMenu" class="submenu">
    <h4>Search Results</h4>
    <div id="generalSearchResultList">
      <!-- Search results will be rendered here -->
    </div>
  </div>

  <div id="physicalExamMenu" class="submenu">
    <h4>Physical Exam</h4>
    <div id="physicalExamList"> 
      </div>
  </div>

  <div id="labMenu" class="submenu">
    <h4>Lab Tests</h4>
    <input type="search" id="labSearchInput" class="submenu-search-input" placeholder="Search for a test..." autocomplete="off">
    <div id="labTestList">
      </div>
  </div>

  <div id="medsMenu" class="submenu">
    <h4>Administer Medication</h4>
    <input type="search" id="medsSearchInput" class="submenu-search-input" placeholder="Search for a medication..." autocomplete="off">
    <div id="medsList">
      <!-- Medication buttons will be generated here later -->
    </div>
  </div>

  <div id="bedsideMenu" class="submenu">
    <h4>Bedside Tests</h4>
    <div id="bedsideTestList">
      </div>
  </div>

  <div id="radiologyMenu" class="submenu">
    <h4>Radiology Orders</h4>
    <div id="radiologyTestList">
      </div>
  </div>

  <!-- NEW: Consultation Submenu -->
  <div id="consultMenu" class="submenu">
    <h4>Consult Speciality</h4>
    <div id="consultList"></div>
  </div>

  <div id="chatWindow" class="submenu">
    <h4>Anamnesis</h4>
    <div id="chatMessages"></div>
    <div class="chat-input-area">
      <input id="chatInput" type="text" placeholder="Ask the patient..." autocomplete="off" />
      <div class="chat-button-container">
        <button id="btnSomaetas" class="btn-secondary">SOMAÄTAS</button>
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </div>

  <div id="dosingModal" class="modal-backdrop">
    <div class="modal-content">
        <h3 id="dosingMedName">Set Dose</h3>
        
        <div id="doseChoices" class="dose-choices-grid"></div>

        <div id="manualDoseContainer" style="display: none;">
            <input type="number" id="doseInput" class="dose-input" autocomplete="off">
            <span id="doseUnitSpan"></span>
        </div>

        <div id="doseConfirmControls" class="modal-footer" style="display: none;">
            <button id="btnConfirmDose" class="btn">Confirm</button>
            <button id="btnCancelDose" class="btn-secondary">Cancel</button>
        </div>
    </div>
  </div>

  <div id="dispositionModal" class="modal-backdrop">
    <div class="modal-content">
      <h3>Select Disposition</h3>
      <p>Where will you send the patient?</p>
      <div class="disposition-choices">
        <button id="btnSendHome">Send Home</button>
        <button id="btnAdmitWard">Admit to Ward</button>
        <button id="btnTransferPCI">Transfer to PCI</button>
        <button id="btnTransferTrombolys">Lägg in för trombolys</button>
        <button id="btnPrepareSurgery">Prepare for Surgery</button>

      </div>
      <button id="btnCancelDisposition" style="background: #555; margin-top: 15px;">Cancel</button>
    </div>
  </div>

  <div id="diagnosisModal" class="modal-backdrop">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Select Final Diagnosis</h2>
            <button id="btnCancelDiagnosis" class="btn-close">×</button>
        </div>
        <div class="modal-body">
            <input type="text" id="diagnosisSearchInput" class="search-input" placeholder="Search diagnoses..." autocomplete="off">
            <div id="diagnosisSelectionList" class="menu-button-grid">
                </div>
        </div>
        <div class="modal-footer">
            <!-- This is the new button -->
            <button id="btnSkipDiagnosis" class="btn-secondary">Continue without Diagnosis</button>
        </div>
    </div>
  </div>

  <div id="feedbackModal" class="modal-backdrop">
    <div class="modal-content">
                <div class="modal-header">
            <h2>Case Report</h2>
            <span id="closeFeedback" class="close-button">&times;</span>
        </div>

        <div class="feedback-summary">
            <div class="score-circle-container">
                <div id="scoreCircle" class="score-circle">
                    <span id="finalScore">0%</span>
                </div>
            </div>
            <div id="correctDiagnosisDisplay" class="diagnosis-display">
                Diagnosis: <span></span>
            </div>
        </div>

        <div class="feedback-tabs">
            <button class="tab-link active" data-tab="utredning">Utredning</button>
            <button class="tab-link" data-tab="åtgärder">Åtgärder</button>
            <button class="tab-link" data-tab="fallbeskrivning">fallbeskrivning</button>
        </div>

        <div class="feedback-content-container">
            <div id="fallbeskrivning" class="tab-content"></div>
            <div id="utredning" class="tab-content active"></div>
            <div id="åtgärder" class="tab-content"></div>
        </div>
        <div class="modal-footer">
            <button id="btnFinishFeedback" class="btn-action-final">Done</button>
        </div>
    </div>
  </div>

  <div id="prescriptionModal" class="modal-backdrop">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Assign Prescriptions</h2>
            <button id="btnCancelPrescription" class="btn-close">×</button>
        </div>
        <div class="modal-body">
            <input type="text" id="prescriptionSearchInput" class="search-input" placeholder="Search prescriptions..." autocomplete="off">
            <div id="prescriptionSelectionList" class="menu-button-grid checkbox-grid">
                <!-- Prescription checkboxes will be rendered here -->
            </div>
            <div id="selectedPrescriptionsContainer">
                <h6>Selected:</h6>
                <div id="selectedPrescriptionsList">
                    <p class="no-items-message">No prescriptions selected.</p>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="btnConfirmPrescription" class="btn-action-final">Confirm & Discharge</button>
        </div>
    </div>
  </div>

  <div id="admissionPlanModal" class="modal-backdrop">
    <div class="modal-content large-modal">

      <div class="modal-header">
        <h2>Plan för inskrivning</h2>
        <button id="btnCancelAdmissionPlan" class="btn-close">×</button>
      </div>

      <div class="modal-body">
        <div id="admissionPlanDisposition" class="plan-disposition-display">
          <!-- The chosen disposition like 'PCI' will be displayed here -->
        </div>

        <h4>Mediciner närmsta dygnet</h4>
        <div id="planMedicationOrdersList"></div>
        <div class="add-med-container" style="margin-top: 10px;"> <button id="btnAddPlanMed" class="btn btn-secondary">Lägg till medicin</button></div>
        <hr>
        <h4>Övervakning och omvårdnad</h4>
        <fieldset class="plan-fieldset">
          <legend class="plan-legend">NEWS:</legend>
          <div id="planVitalsFreq" class="button-group">
            <button class="btn-toggle active" data-value="none">Aldrig</button>
            <button class="btn-toggle" data-value="8h">Varje 8h</button>
            <button class="btn-toggle" data-value="4h">Varje 4h</button>
            <button class="btn-toggle" data-value="2h">Varje 2h</button>
            <button class="btn-toggle" data-value="1h">Varje 1h</button>
          </div>
        </fieldset>

        <div class="button-toggle-group">
         <button class="btn-toggle" id="planFasta">Fasta</button>          
          <button class="btn-toggle" id="planUrineOutput">Vätske- och urinmätning</button>
          <button class="btn-toggle" id="planDailyWeight">Daglig vikt</button>
          <button class="btn-toggle" id="planGlucoseCurve">Glukoskurva</button>
          <button class="btn-toggle" id="planSurgeryNotification">Operationsanmälan</button>
        </div>
      </div>

      <div class="modal-footer">
        <div class="disposition-choices">
         <button id="btnConfirmAdmissionPlan" class="btn-action-final">Confirm Admission & Plan</button>
         <button id="btnFooterCancelAdmissionPlan">Cancel</button> 
         </div>
      </div>
  </div>
</div>

<div id="addPlanMedModal" class="modal-backdrop">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Select Medication to Add</h2>
            <button id="btnCancelAddPlanMed" class="btn-close">×</button>
        </div>
        <div class="modal-body">
            <input type="text" id="planMedSearchInput" class="search-input" placeholder="Search medications..." autocomplete="off">
            <div id="planMedSelectionList" class="menu-button-grid">
                </div>
        </div>
    </div>
</div>

  <!-- NEW: Akutrum Intro Modal -->
  <div id="akutrumIntroModal" class="modal-backdrop hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Welcome to the Akutrum!</h2>
        </div>
        <div class="modal-body">
            <p>I akutrummet handlägger du patienter enligt <strong>ABCDE. </strong> De olika åtgärderna syns inte av sig själv utan du måste själv söka efter en åtgärd som visas först efter 3 bokstäver som stämmer överrens med åtgärden. Skriver du exempelvis "kol" så dyker förslaget "kolla i munnen" upp.  
            <p>På akutrummet finns flera nya undersökningar för att bedöma patienten akut medan andra saknas.</p> 
            </p>I akutrummet kan enbart akuta prover tas och de som inte hade gett resultat omedelbart i verkligheten gör inte det här heller.</p>
            <p>När den akuta handläggningen är klar kan du skicka vidare patienten eller fortsätta handläggningen i ett vanligt rum. Där visas svar på undersökningar som du beställt men som inte kom direkt på akutrummet. Där beställer du även de "vanliga" röntgenundersökningarna.</p>
            <p>Lycka till!</p>
            <div class="checkbox-item" style="margin-top: 20px;">
                <input type="checkbox" id="dontShowAkutrumIntroAgain">
                <label for="dontShowAkutrumIntroAgain" style="cursor: pointer;">Don't show this again</label>
            </div>
        </div>
        <div class="modal-footer">
            <button id="confirmAkutrumIntro" class="btn-action-final">Got it!</button>
        </div>
    </div>
  </div>


  <div id="ekgModal" class="modal-backdrop">
    <div class="modal-content large-modal">
      <button id="closeEkgModal" title="Close EKG">×</button>
      <h3>EKG Analysis</h3>
      <div id="ekgImageContainer">
        <img id="ekgImage" src="" alt="Patient EKG" />
      </div>
      <div id="ekgInterpretation" style="display: none; margin-top: 15px; border-top: 1px solid #555; padding-top: 15px;">
        <h4>Official Interpretation:</h4>
        <p id="ekgInterpretationText"></p>
      </div>
      <button id="showEkgInterpretationBtn">Show Interpretation</button>
    </div>
  </div>

  <div id="failureModal" class="modal-backdrop">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="failureTitle">Case Lost</h3>
      </div>
      <div class="modal-body">
        <p id="failureMessage">The patient's condition deteriorated beyond recovery due to critical vital signs being unstable for too long.</p>
      </div>
      <div class="modal-footer">
        <button id="btnReturnToMenu">Return to Main Menu</button>
      </div>
    </div>
  </div>

  <!-- NEW: Combined Game Review Modal -->
  <div id="gameReviewModal" class="modal-backdrop hidden">
      <div class="modal-content">
          <div class="modal-header">
              <h2>Review AQTEN</h2>
          </div>
          <div class="modal-body">
              <div class="review-question">
                  <p>Vilken termin studerar du?</p>
                  <!-- NEW: Use a dropdown for semester selection to save space -->
                  <select id="semesterSelect" name="semester" class="review-select">
                      <option value="" disabled selected>Välj termin...</option>
                      <option value="1">Termin 1</option>
                      <option value="2">Termin 2</option>
                      <option value="3">Termin 3</option>
                      <option value="4">Termin 4</option>
                      <option value="5">Termin 5</option>
                      <option value="6">Termin 6</option>
                      <option value="7">Termin 7</option>
                      <option value="8">Termin 8</option>
                      <option value="9">Termin 9</option>
                      <option value="10">Termin 10</option>
                      <option value="11">Termin 11</option>
                      <option value="12">Termin 12</option>
                      <option value="examinerad">Examinerad</option>
                  </select>
              </div>
              <div class="review-question">
                  <p>Hur lärorikt upplever du AQTEN?</p>
                  <div class="number-rating-group centered-group">
                      <span>Inte alls</span>
                      <div class="rating-numbers">
                          <input type="radio" id="edu1" name="educationalValue" value="1"><label for="edu1">1</label>
                          <input type="radio" id="edu2" name="educationalValue" value="2"><label for="edu2">2</label>
                          <input type="radio" id="edu3" name="educationalValue" value="3"><label for="edu3">3</label>
                          <input type="radio" id="edu4" name="educationalValue" value="4"><label for="edu4">4</label>
                          <input type="radio" id="edu5" name="educationalValue" value="5"><label for="edu5">5</label>
                      </div>
                      <span>Väldigt lärorikt!</span>
                  </div>
              </div>

              <div class="review-question">
                  <p>Hur sannolikt är det att du rekommenderar AQTEN till andra?</p>
                  <div class="number-rating-group centered-group">
                      <span>Inte alls</span>
                      <div class="rating-numbers">
                          <input type="radio" id="rec1" name="recommendLikelihood" value="1"><label for="rec1">1</label>
                          <input type="radio" id="rec2" name="recommendLikelihood" value="2"><label for="rec2">2</label>
                          <input type="radio" id="rec3" name="recommendLikelihood" value="3"><label for="rec3">3</label>
                          <input type="radio" id="rec4" name="recommendLikelihood" value="4"><label for="rec4">4</label>
                          <input type="radio" id="rec5" name="recommendLikelihood" value="5"><label for="rec5">5</label>
                      </div>
                      <span> Väldigt sannolikt! </span>
                  </div>
              </div>

              <div class="review-question">
                  <p>I fullversionen får du tillgång till fler fall och kan öva inom specialiteter. Baserat på det du upplevt hittills, hur sannolikt är det att du skulle köpa fullversionen? </p>
                  <div class="number-rating-group centered-group">
                      <span>Inte alls</span>
                       <div class="rating-numbers">
                          <input type="radio" id="pur1" name="purchaseLikelihood" value="1"><label for="pur1">1</label>
                          <input type="radio" id="pur2" name="purchaseLikelihood" value="2"><label for="pur2">2</label>
                          <input type="radio" id="pur3" name="purchaseLikelihood" value="3"><label for="pur3">3</label>
                          <input type="radio" id="pur4" name="purchaseLikelihood" value="4"><label for="pur4">4</label>
                          <input type="radio" id="pur5" name="purchaseLikelihood" value="5"><label for="pur5">5</label>
                      </div>
                      <span> Väldigt sannolikt!</span>
                  </div>
              </div>

              <div class="review-question">
                  <p>Har du förslag på vad du vill se i AQTEN??</p>
                  <textarea id="improvementSuggestions" class="feedback-textarea" rows="4" placeholder="Your feedback is valuable..."></textarea>
              </div>
          </div>
          <div class="modal-footer">
              <button id="btnSubmitGameReview" class="btn-action-final" disabled>Skicka</button>
          </div>
      </div>
  </div>

  <!-- NEW: Ambulance Pre-arrival Report Modal -->
  <div id="ambulanceReportModal" class="modal-backdrop">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Ambulance Incoming!</h2>
        </div>
        <div class="modal-body">
            <p>An ambulance is en route with the following report:</p>
            <div id="ambulanceReportContent" class="report-content-box"></div>
        </div>
        <div class="modal-footer">
            <button id="btnAcknowledgeArrival" class="btn-action-final">Understod</button>
        </div>
    </div>
  </div>

  <!-- NEW: Consultation Response Bubble -->
  <div id="consultationBubble" class="speech-bubble-popup hidden">
      <div id="consultationBubbleHeader" class="speech-bubble-header">
          <span id="consultationBubbleTitle"></span>
          <button id="closeConsultationBubble" class="btn-close-bubble">×</button>
      </div>
      <div id="consultationBubbleContent" class="speech-bubble-content"></div>
  </div>

  <button id="logoutBtn" class="hidden">Logout</button>

  <div id="critical-warning-overlay" class="hidden"></div>
  

    <!-- The main.js file will now correctly import from the /js/game/ directory -->
    <script src="js/main.js" type="module"></script> 

    <!-- iPad Detection Script -->
    <script>
      (function() {
        const isIpad = /iPad/i.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        if (isIpad) {
          document.body.classList.add('ipad');
        }
      })();
    </script>


  </body>
</html>
